<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Connexion</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <link rel="stylesheet" type="text/css" href="../CSS/tableAdmin.css"/>
        <link rel="stylesheet" type="text/css" href="../../CSS/Programme.css"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <script src="https://code.jquery.com/jquery-3.5.1.js" integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc=" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/2.2.0/anime.min.js"></script>
    </head>

    <body>

        <div id="updateLiens" class="container-fluid justify-content-evenly" style="text-align:center;align-content:center;justify-content:center;padding:5%;">
            
        </div>

        <div id="liens" class="row justify-content-evenly" style="margin:1%;margin-top:5%;display: flex;align-content: center;text-align: center;justify-content: center;">
            <div  class="col justify-content-evenly" style="align-content: center;text-align: center;justify-content: center;">
                <div id="tableGestionLiensHeader" class="table justify-content-evenly" style="align-content: center;text-align: center;justify-content: center;">
                
                </div>
                <div id="tableGestionLiens" class="table-content justify-content-evenly"  style="align-content: center;text-align: center;justify-content: center;">
                
                </div>
            </div>
        </div>
    </body>


    <script>
        function resize() {
            if(screen.width>800){
                jQuery('#MenuBar').load('Menu.html#MenuOrdi');
            }
            else{
                jQuery('#MenuBar').load('MenuCell.html#MenuCell');
            }
        }
        $(window).on("resize", resize);
        resize();



        $.ajax({
            url: "../PHP/Gestion_Liens/getAllLink.php",
            type: "POST",
            dataType: "json",
            success: function(result)
            {
                $("#tableGestionLiensHeader").append(
                "<div class='table-header'>"+
                    "<div class='col'>Type de liens</div>"+
                    "<div class='col'>Description</div>"+
                    "<div class='col'>Liens</div>"+
                    "<div class='col'>Personne</div>"+
                    "<div class='col'>Modifier le liens</div>"+
                    "<div class='col'>Supprimer le liens</div>"+
                "</div>"
                );
                for (var i = 0; i < result.length; i++) {
                         $("#tableGestionLiens").append(
                            "<div class='table-row'>"+
                        "<div class='col'>"+result[i][1]+"</div>"+
                        "<div class='col'>"+result[i][2]+"</div>"+
                        "<div class='col'>"+result[i][3]+"</div>"+
                        "<div class='col'>"+result[i][4]+"</div>"+
                        "<div id='btnModifier' class='col' onclick='updateLink("+result[i][0]+")'><p class='horizontal' ><span class='text' style='font-size:10px;'>Modifier</span></p></div>"+
                        "<div id='btnSuprimmer' class='col' onclick='deleteLink("+result[i][0]+")'><p class='horizontal' ><span class='text' style='font-size:10px;'>Supprimer</span></p></div>"+
                        "</div>");
                     }
                    
            },
            error: function (message, er) {
                console.log(er);
            }
        });

    function deleteLink(id){

        if (confirm("Êtes-vous certain de vouloir supprimer l'administrateur: "+id)) {
		$.ajax({
			url: "../PHP/Gestion_Liens/deleteLink.php",
			type: "POST",
			data: {
				"id": id
			},
			dataType: "json",
			success: function(result){
				location.reload();
			},
			error: function (message, er) {
				console.log("error: " + er);
			}
		});
	  } else {

	  }
    }


    function updateLink(id){

        $.ajax({
			url: "../PHP/Gestion_Liens/getOneLink.php",
			type: "POST",
			data: {
				"id": id
			},
			dataType: "json",
			success: function(result){

            $("#updateLiens").empty();
            $("#updateLiens").append(
            "<div class='row justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+
                     "<div class='row justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+
                    "<h4>Id</h4>"+
                    "<input id='inputID' readonly type='text' placeholder='ID du lien' autocomplete='no' value='"+id+"'>"+
                     "<h4>Type de liens</h4>"+
                    "<input id='inputType' type='text' placeholder='Type de lien' autocomplete='no' value='"+result[0][1]+"'>"+

            "</div>"+ 
            "<div class='row justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+
                "<h4>Nom de la personne qui met le lien</h4>"+
                "<input id='inputNom' type='text' placeholder='Personne qui ajoute le lien' autocomplete='no' value='"+result[0][4]+"'>"+
                "<h4>Lien</h4>"+
                "<input id='inputLiens' type='text' placeholder='Le lien' autocomplete='no' value='"+result[0][3]+"'>"+
            "</div>"+ 
            "<div class='row justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+        
                    "<h4>Description du lien</h4>"+
                    "<textarea id='inputDescription' type='text' rows='4' cols='50' half placeholder='Description'>"+result[0][2]+"</textarea>"+
            "</div>"+ 
    
            "<div class='row justify-content-evenly'  style='text-align:center;align-content:center;justify-content:center;'>"+
                "<div class='col justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+
                    "<p id='btnTester' class='horizontal'><span class='text'>Tester le liens</span></p>"+
                "</div>"+
                "<div class='col justify-content-evenly' style='text-align:center;align-content:center;justify-content:center;'>"+
                    "<p id='btnConfirmer' class='horizontal'><span class='text'>Confirmer le changement</span></p>"+
                "</div>"+
            "</div>"
            );


            $("#btnTester").click(function() {	
                var test = $("#inputLiens").val();	
                window.location.replace(test);
            });

             $("#btnConfirmer").click(function() {
            var mdp = $("#inputMdp").val();
            if (confirm("Êtes-vous certain de vouloir modifier le liens: "+id)) 
            {
                var type= $("#inputType").val();
                var description= $("#inputDescription").val();
                var lien= $("#inputLiens").val();
                var personne= $("#inputNom").val();

                if(type=="" || type==null || type.length>15){
                    alert("Le champ type de liens ne peut pas être vide et ne peut pas contenir plus de 15 caractères");
                }else{
                    if(type=="Programmation" || type=="Informatique"  || type=="Annonce" ){
                        if(description=="" || description==null || description.length>500){
                            alert("Le champ description ne peut pas être vide et ne peut pas contenir plus de 500 caractères");
                        }
                        else{
                            if(lien=="" || lien==null || lien.length>200){
                                alert("Le champ lien ne peut pas être vide et ne peut pas contenir plus de 200 caractères");
                            }
                            else{
                                if(personne=="" || personne==null || personne.length>30 || !(/^[A-Za-z\s]+$/.test(personne))){
                                    alert("Le champ personne ne peut pas être vide et ne peut pas contenir plus de 30 caractères. Aussi il doit être composé de lettre seulement.");
                                }
                                else{
                                        $.ajax({
                                            url: "../PHP/Gestion_Liens/updateLink.php",
                                            type: "POST",
                                            data: {
                                                "id":id,
                                                "type":  type,
                                                "description": description,
                                                "lien":  lien,
                                                "personne":  personne
                                            },
                                            dataType: "json",
                                            success: function(result){
                                                alert("Les informations du liens ont bien été mise à jour");
                                                location.reload();
                                            },
                                            error: function (message, er) {
                                                console.log("error: " + er);
                                            }
                                        });
                                    }
                                }
                            }

                    }else{
                        alert("Le champ type de liens doit correspondre à l'une des catégories suivantes: Programmation, Informatique ou Annonce");
                    }
                }
            }
        });
			},
			error: function (message, er) {
				console.log("error: " + er);
			}
		});

    
    }

    </script>
</html>